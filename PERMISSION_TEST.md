# 权限控制测试指南

## 功能概述

已为HRMS系统添加了权限控制功能，非admin和leader用户无法访问高级管理菜单下的页面。

## 权限控制范围

以下页面需要admin或leader权限才能访问：
- 部门管理 (`/department/list`)
- 收支管理 (`/system/payment`)
- 用户管理 (`/system/user`)
- 系统日志 (`/system/log`)

## 用户角色

- **admin**: 管理员，拥有所有权限
- **leader**: 领导，拥有高级管理权限
- **user**: 普通用户，只能访问基础功能

## 测试步骤

### 1. 测试Admin用户
1. 在登录页面点击"测试Admin登录"按钮
2. 登录成功后，应该能看到"高级管理"菜单
3. 点击高级管理下的任意子菜单，应该能正常访问

### 2. 测试Leader用户
1. 在登录页面点击"测试Leader登录"按钮
2. 登录成功后，应该能看到"高级管理"菜单
3. 点击高级管理下的任意子菜单，应该能正常访问

### 3. 测试普通用户
1. 在登录页面点击"测试普通用户登录"按钮
2. 登录成功后，**不应该**看到"高级管理"菜单
3. 如果直接访问高级管理页面URL，会被重定向到禁止访问页面

### 4. 测试禁止访问页面
1. 以普通用户身份登录
2. 在浏览器地址栏直接输入以下URL之一：
   - `http://localhost:3000/department/list`
   - `http://localhost:3000/system/payment`
   - `http://localhost:3000/system/user`
   - `http://localhost:3000/system/log`
3. 应该看到"访问被拒绝"页面，而不是原始页面内容

## 预期结果

- ✅ Admin和Leader用户：可以看到高级管理菜单，能正常访问所有页面
- ✅ 普通用户：看不到高级管理菜单，访问受限页面时显示禁止访问页面
- ✅ 路由守卫：自动拦截无权限访问并重定向到禁止访问页面
- ✅ 菜单控制：根据用户权限动态显示/隐藏菜单项

## 技术实现

1. **用户角色管理**: 在User类型中添加role字段
2. **权限检查**: 在auth store中添加hasAdminAccess计算属性
3. **路由守卫**: 在router中添加权限检查逻辑
4. **菜单控制**: 在MainLayout中使用v-if控制菜单显示
5. **禁止访问页面**: 创建ForbiddenView组件显示友好的错误信息

## 注意事项

- 当前角色分配基于用户名：admin→admin, leader→leader, 其他→user
- 如需修改角色分配逻辑，请修改`getRoleByUsername`函数
- 如需添加新的受限页面，请在`adminRoutes`数组中添加对应路径
